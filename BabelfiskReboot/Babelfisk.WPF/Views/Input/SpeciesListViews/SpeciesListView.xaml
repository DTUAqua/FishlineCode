<UserControl x:Class="Babelfisk.WPF.Views.Input.SpeciesListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:aCtrls="clr-namespace:Anchor.Core.Controls;assembly=Anchor.Core.Controls"
             xmlns:acom="clr-namespace:Anchor.Core.Common;assembly=Anchor.Core"
             xmlns:ent="clr-namespace:Babelfisk.Entities.Sprattus;assembly=Babelfisk.Entities"
             xmlns:beh="clr-namespace:Babelfisk.WPF.Infrastructure.Behaviors"
             xmlns:dGrid="clr-namespace:Babelfisk.WPF.Infrastructure.DataGrid"
             xmlns:inf="clr-namespace:Babelfisk.WPF.Infrastructure"
             xmlns:cnv="clr-namespace:Babelfisk.WPF.Converters"
             xmlns:inp="clr-namespace:Babelfisk.WPF.Views.Input"
             xmlns:ancSl="clr-namespace:Anchor.Core.Controls.Sliders;assembly=Anchor.Core.Controls"
             xmlns:set="clr-namespace:Babelfisk.BusinessLogic.Settings;assembly=Babelfisk.BusinessLogic"
             xmlns:ancBe="clr-namespace:Anchor.Core.Controls.Behaviors;assembly=Anchor.Core.Controls"
             xmlns:Microsoft_Windows_Themes="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Aero"
             mc:Ignorable="d" x:Name="uCtrl"
             d:DesignHeight="300" d:DesignWidth="1000" >

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Resources/Styles/InputStyles.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources/Styles/GreenRedCheckBoxStyle.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources/Styles/HeaderButtons.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources/Styles/DataGridStyles.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/Resources/Styles/ZoomSliderStyles.xaml"/>

                <ResourceDictionary>
                    <cnv:StringShowOnContainsToVisibilityConverter x:Key="cStringShowOnContains" />
                    <cnv:StringHideOnContainsToVisibilityConverter x:Key="cStringHideOnContains" />
                    <cnv:DataGridColumnMapToVisibilityConverter x:Key="cColumnMapToVisibility" />

                    <inf:BindingProxy x:Key="proxyContext" Data="{Binding Path=DataContext, ElementName=uCtrl}" />
                    
                    <SolidColorBrush x:Key="Step0Color" Color="#E55ABD5A" />
                    <SolidColorBrush x:Key="Step1Color" Color="#E54D86EA" />
                    <SolidColorBrush x:Key="Step2Color" Color="#E5E46868" />
                    <SolidColorBrush x:Key="StepEjRepColor" Color="#FFBFBFBF" />

                    <SolidColorBrush x:Key="UpperHeaderGroundColor" Color="#FF666666" />

                    <SolidColorBrush x:Key="UpperHeaderForegroundColor" Color="WhiteSmoke" />
                    <SolidColorBrush x:Key="LowerHeaderForegroundColor" Color="White" />
                    
                    <DataTemplate x:Key="GridColumnHeaderDefault" >
                        <Border BorderBrush="{StaticResource GridBorderBrush}" 
                                Height="50" Background="Transparent"
                                SnapsToDevicePixels="True"
                                Width="{Binding RelativeSource={RelativeSource AncestorType=DataGridColumnHeader}, Path=ActualWidth}"
                                BorderThickness="{Binding Path=HeaderBorder}" DataContext="{Binding Path=Content, RelativeSource={RelativeSource AncestorType=DataGridColumnHeader, Mode=FindAncestor}}">
                            <Grid >
                                <Grid.RowDefinitions >
                                    <RowDefinition />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition />
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" BorderBrush="{Binding Path=UpperHeaderBorderBrush}" Margin="0,0,0,-1" Panel.ZIndex="10" Background="{Binding Path=UpperHeaderBackground}" BorderThickness="{Binding Path=UpperHeaderBorderThickness}" SnapsToDevicePixels="True">
                                    <TextBlock Text="{Binding Path=UpperHeader}" Margin="4,0,4,0" VerticalAlignment="Center" Foreground="{Binding Path=UpperHeaderForeground}"  />
                                </Border>

                                <Border Grid.Row="1" Height="1" Background="{StaticResource GridBorderBrush}" SnapsToDevicePixels="True" />

                                <Border Grid.Row="2" BorderBrush="{StaticResource GridBorderBrush}" BorderThickness="{Binding Path=LowerHeaderBorder}" Background="Transparent" ToolTip="{Binding Path=LowerHeader}" Panel.ZIndex="5" SnapsToDevicePixels="True" >
                                    <TextBlock VerticalAlignment="Center" HorizontalAlignment="{Binding Path=LowerHeaderHorizontalAlignment}" FontWeight="Normal" Margin="4,0,4,0" Text="{Binding Path=LowerHeader}" Foreground="{Binding Path=LowerHeaderForeground}" />
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>

                    <DataTemplate x:Key="GridColumnHeaderSettings" >
                        <Border BorderBrush="{StaticResource GridBorderBrush}" 
                                Height="50" Background="Transparent"
                                SnapsToDevicePixels="True"
                                Width="{Binding RelativeSource={RelativeSource AncestorType=DataGridColumnHeader}, Path=ActualWidth}"
                                BorderThickness="{Binding Path=HeaderBorder}" DataContext="{Binding Path=Content, RelativeSource={RelativeSource AncestorType=DataGridColumnHeader, Mode=FindAncestor}}">
                            <Grid >
                                <Grid.RowDefinitions >
                                    <RowDefinition />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition />
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" BorderBrush="{Binding Path=UpperHeaderBorderBrush}" Margin="0,0,0,-1" Panel.ZIndex="10" Background="{Binding Path=UpperHeaderBackground}" BorderThickness="{Binding Path=UpperHeaderBorderThickness}" SnapsToDevicePixels="True">
                                    <inp:ColumnVisibilityView Height="{Binding Path=ActualWidth, RelativeSource={RelativeSource Self}}" VerticalAlignment="Center" Margin="2,0,2,0"
                                                              IsEnabled="{Binding Path=Data.HasColumnVisibility, Source={StaticResource proxyContext}}"
                                                              DataContext="{Binding Path=Data.ColumnVisibility, Source={StaticResource proxyContext}}" />
                                </Border>

                                <Border Grid.Row="1" Height="1" Background="{StaticResource GridBorderBrush}" SnapsToDevicePixels="True" />

                                <Border Grid.Row="2" BorderBrush="{StaticResource GridBorderBrush}" BorderThickness="{Binding Path=LowerHeaderBorder}" Background="Transparent" ToolTip="{Binding Path=LowerHeader}" Panel.ZIndex="5" SnapsToDevicePixels="True" >
                                    <TextBlock VerticalAlignment="Center" HorizontalAlignment="{Binding Path=LowerHeaderHorizontalAlignment}" FontWeight="Normal" Margin="4,0,4,0" Text="{Binding Path=LowerHeader}" Foreground="{Binding Path=LowerHeaderForeground}" />
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>

                    <Style x:Key="cellBorderStyle" TargetType="{x:Type Border}">
                        <Setter Property="BorderBrush" Value="{StaticResource GridBorderBrush}" />
                        <Setter Property="BorderThickness" Value="0,1,1,0" />
                        <Setter Property="MaxHeight" Value="32" />
                        <Setter Property="MinHeight" Value="21" />
                        <Setter Property="Background" Value="{StaticResource ResourceKey=GridHeaderStyle}" />
                    </Style>
                    
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>

    </UserControl.Resources>
    <UserControl.Triggers>
        <!-- Event animations for collapsible row details panel -->
        <EventTrigger RoutedEvent="ToggleButton.Checked" SourceName="tglBtnFilter">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="grdFilter"
                                    Storyboard.TargetProperty="Height"
                                    From="100"
                                    To="0"
                                    Duration="0:0:.2"
                                    />
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
        <EventTrigger RoutedEvent="ToggleButton.Unchecked" SourceName="tglBtnFilter">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="grdFilter"
                                    Storyboard.TargetProperty="Height"
                                    From="0"
                                    To="100"
                                    Duration="0:0:.2"
                                    />
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </UserControl.Triggers>

    <Grid>
        <Grid Background="White"
          KeyboardNavigation.TabNavigation="Cycle"
          IsEnabled="{Binding Path=IsLoading, Converter={StaticResource ResourceKey=cBoolToBoolNegation}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header (with navigation buttons) -->
            <Grid Grid.Row="0">

                <Border BorderBrush="LightGray" BorderThickness="0,0,0,0" Background="{StaticResource InputHeaderBackground}"
                    TextBlock.Foreground="{StaticResource InputHeaderForeground}"
                    SnapsToDevicePixels="True" KeyboardNavigation.TabNavigation="None">
                    <Grid DockPanel.Dock="Bottom" Margin="10,10,10,10" IsEnabled="{Binding Path=IsLoading, Converter={StaticResource ResourceKey=cBoolToBoolNegation}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <DockPanel Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Left">
                            <TextBlock Text="Artsliste" DockPanel.Dock="Left" VerticalAlignment="Center" FontSize="26" />
                        </DockPanel>

                        <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right" Orientation="Horizontal">
                            <TextBlock DockPanel.Dock="Left" Text="{Binding Path=TripType}" VerticalAlignment="Center" FontSize="18" Margin="0,0,10,0" >
                            </TextBlock>

                            <Image Height="23" Width="23" Margin="0,0,0,0" Source="pack://application:,,,/Resources/Images/Treeview/specieslist.ico" ></Image>
                        </StackPanel>

                        <Viewbox Grid.Column="1" Stretch="Uniform" StretchDirection="DownOnly" HorizontalAlignment="Center" VerticalAlignment="Center"  Margin="10,0,10,0" >
                            <DockPanel Visibility="{Binding Path=IsLoading, Converter={StaticResource ResourceKey=cBoolToVisibility}, ConverterParameter=False}">
                                <!-- Station -->
                                <DockPanel DockPanel.Dock="Right">
                                    <DockPanel.Style>
                                        <Style TargetType="{x:Type DockPanel}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=TripType}" Value="HVN" >
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DockPanel.Style>
                                    <aCtrls:HeaderButton  DockPanel.Dock="Right" ToolTip="Klik for at gå til stationen" HorizontalAlignment="Right" 
                                              Command="{Binding Path=ShowStationCommand}" Style="{StaticResource ResourceKey=headerInfoButton}" >
                                        <aCtrls:HeaderButton.Header>
                                            <Image Height="22" Margin="0,0,0,0" >
                                                <Image.Style>
                                                    <Style TargetType="{x:Type Image}">
                                                        <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/sample.png" />
                                                    </Style>
                                                </Image.Style>
                                            </Image>
                                        </aCtrls:HeaderButton.Header>
                                        <aCtrls:HeaderButton.Content>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="6">
                                                <TextBlock Text="{Binding Path=Sample.station}" />
                                            </StackPanel>
                                        </aCtrls:HeaderButton.Content>
                                    </aCtrls:HeaderButton>

                                    <Image DockPanel.Dock="Right" Source="pack://application:,,,/Resources/Images/Common/ArrowRight.ico" Margin="10,0,10,0"  Width="20" />
                                </DockPanel>


                                <!-- Trip -->
                                <aCtrls:HeaderButton  DockPanel.Dock="Right" ToolTip="Klik for at gå til turen" HorizontalAlignment="Right" 
                                              Command="{Binding Path=ShowTripCommand}" Style="{StaticResource ResourceKey=headerInfoButton}" >
                                    <aCtrls:HeaderButton.Header>
                                        <Image Height="22" Margin="0,0,0,0" >
                                            <Image.Style>
                                                <Style TargetType="{x:Type Image}">
                                                    <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/søs.png" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=TripType}" Value="VID">
                                                            <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/vid.png" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Path=TripType}" Value="HVN">
                                                            <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/hvn.png" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Path=TripType}" Value="REKHVN">
                                                            <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/HookHarbour.ico" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Path=TripType}" Value="REKTBD">
                                                            <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/HookVessel.ico" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Path=TripType}" Value="REKOMR">
                                                            <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/HookArea.ico" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>
                                    </aCtrls:HeaderButton.Header>
                                    <aCtrls:HeaderButton.Content>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="6">
                                            <TextBlock Text="{Binding Path=Trip.trip1}" />
                                        </StackPanel>
                                    </aCtrls:HeaderButton.Content>
                                </aCtrls:HeaderButton>

                                <Image DockPanel.Dock="Right" Source="pack://application:,,,/Resources/Images/Common/ArrowRight.ico" Margin="10,0,10,0"  Width="20" />

                                <!-- Cruise -->
                                <aCtrls:HeaderButton  DockPanel.Dock="Right" HorizontalAlignment="Right" ToolTip="Klik for at gå til togtet"
                                              Command="{Binding Path=ShowCruiseCommand}" Style="{StaticResource ResourceKey=headerInfoButton}" >
                                    <aCtrls:HeaderButton.Header>
                                        <Image Source="pack://application:,,,/Resources/Images/Treeview/vessel.ico" Opacity="0.7" Height="20" Margin="0,0,0,0" />
                                    </aCtrls:HeaderButton.Header>
                                    <aCtrls:HeaderButton.Content>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="6">
                                            <TextBlock Text="{Binding Path=Cruise.cruise1}" />
                                        </StackPanel>
                                    </aCtrls:HeaderButton.Content>
                                </aCtrls:HeaderButton>

                                <Image DockPanel.Dock="Right" Source="pack://application:,,,/Resources/Images/Common/ArrowRight.ico" Margin="10,0,10,0"  Width="20" />

                                <!-- Year -->
                                <aCtrls:HeaderButton  DockPanel.Dock="Right" ToolTip="År" Tag="Disabled" HorizontalAlignment="Right" 
                                              KeyboardNavigation.IsTabStop="False"
                                              Style="{StaticResource ResourceKey=headerInfoButton}">
                                    <aCtrls:HeaderButton.Header>
                                        <Image Source="pack://application:,,,/Resources/Images/Treeview/Year4.ico" Height="18" Margin="0,0,0,0" />
                                    </aCtrls:HeaderButton.Header>
                                    <aCtrls:HeaderButton.Content>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="6">
                                            <TextBlock Text="{Binding Path=Cruise.year}" />
                                        </StackPanel>
                                    </aCtrls:HeaderButton.Content>
                                </aCtrls:HeaderButton>

                            </DockPanel>
                        </Viewbox>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Grid -->
            <DockPanel x:Name="dpGrid" Grid.Row="1" >
                <!-- Overall input methods (for SEA only) -->
                <Border DockPanel.Dock="Top" BorderBrush="{StaticResource GridBorderBrush}" Background="White" KeyboardNavigation.TabNavigation="Local" KeyboardNavigation.TabIndex="1" BorderThickness="0,1,0,0" SnapsToDevicePixels="True">
                    <Border.Style>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=TripType}" Value="SØS" >
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Path=TripType}" Value="VID" >
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <Border  Margin="0,10,0,10" CornerRadius="0,0,0,0" >
                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                            <DockPanel Margin="0" >
                                <!-- Trip weight -->
                                <Label Content="Totalfangst (UR) (kg)" DockPanel.Dock="Left" Margin="0,0,10,0" Width="145" Style="{StaticResource ResourceKey=txtHeader}" />

                                <Grid>
                                    <TextBox x:Name="tbStationNumber" DockPanel.Dock="Left" ancBe:SelectTextOnFocus.Active="True" Width="100" HorizontalAlignment="Left"
                                     Text="{Binding Path=TotalWeight, Converter={StaticResource ResourceKey=cStringToDecimal}, ConverterParameter=4}" 
                                     Style="{StaticResource ResourceKey=txtValue}"  />
                                </Grid>

                            </DockPanel>

                            <DockPanel Margin="0,0,0,0" >
                                <DockPanel.Style>
                                    <Style TargetType="{x:Type DockPanel}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Path=TripType}" Value="SØS" >
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DockPanel.Style>

                                <!-- Lab Journal number -->
                                <Label Content="Vægtestimeringsmetode" Width="180" DockPanel.Dock="Left" Style="{StaticResource ResourceKey=txtHeader}" />

                                <aCtrls:FilteredComboBox ItemsSource="{Binding Path=WeightEstimationMethods}" DisplayMemberPath="UIDisplay" Width="220"
                                                 Style="{StaticResource ResourceKey=baseInputBoxStyle}" FilterFromStart="True"
                                                 TabOnEnter="False" MinimumSearchLength="1" IsEditable="True" IsTextSearchCaseSensitive="False"
                                                 SelectedItem="{Binding Path=WeightEstimationMethod, UpdateSourceTrigger=PropertyChanged}" OpenOnFocus="True" />
                            </DockPanel>
                        </StackPanel>
                    </Border>

                </Border>

                <!-- DataGrid -->
                <Border BorderBrush="{StaticResource GridBorderBrush}" BorderThickness="0,1,0,0" Panel.ZIndex="5" SnapsToDevicePixels="True"
                        KeyboardNavigation.TabIndex="2" KeyboardNavigation.TabNavigation="Local"
                        >
                    <aCtrls:AncDataGrid x:Name="dataGrid" ItemsSource="{Binding Path=Items}" 
                        CanUserAddRows="False" SelectedItem="{Binding Path=SelectedItem, UpdateSourceTrigger=PropertyChanged}" IsSynchronizedWithCurrentItem="True"
                        AutoGenerateColumns="False" RowHeaderWidth="0"  Background="{StaticResource ResourceKey=GeneralBackground}"
                        SelectionMode="Single" KeyboardNavigation.TabIndex="1" CanUserSortColumns="True"
                        CanUserDeleteRows="False" CanUserResizeRows="False" HorizontalGridLinesBrush="LightGray"
                        VerticalGridLinesBrush="LightGray" BorderBrush="LightGray" BorderThickness="0" DockPanel.Dock="Top" RowDetailsVisibilityMode="Collapsed"
                        VirtualizingStackPanel.VirtualizationMode="Recycling" 
                        RowEditEnding="dataGrid_RowEditEnding" Tag="{Binding Path=DataContext, ElementName=uCtrl}"
                        SelectedIndex="0" Loaded="dataGrid_Loaded" DataContextChanged="dataGrid_DataContextChanged"
                        CellFooterVisibility="Visible" 
                        CellFooterBorderStyle="{StaticResource cellBorderStyle}"
                        ColumnHeaderStyle="{StaticResource ResourceKey=defaultColumnHeaderStyle}" >
                        
                        <aCtrls:AncDataGrid.LayoutTransform>
                            <ScaleTransform ScaleY="{Binding Source={x:Static set:Settings.Instance}, Path=ZoomLevelSpeciesList, Converter={StaticResource ResourceKey=cDivideBy}, ConverterParameter=100}" 
                                            ScaleX="{Binding Source={x:Static set:Settings.Instance}, Path=ZoomLevelSpeciesList, Converter={StaticResource ResourceKey=cDivideBy}, ConverterParameter=100}"/>
                        </aCtrls:AncDataGrid.LayoutTransform>
                        <aCtrls:AncDataGrid.ContextMenu>
                            <ContextMenu DataContext="{Binding Path=PlacementTarget.DataContext, RelativeSource={x:Static RelativeSource.Self}}" 
                                         Tag="{Binding Path=PlacementTarget.Tag, RelativeSource={x:Static RelativeSource.Self}}">
                                <MenuItem Header="Tilføj række" Command="{Binding Path=Tag.AddRowCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Style="{StaticResource defaultMenuItem}" >
                                    <MenuItem.Icon>
                                        <Image Width="15" Height="15" Margin="3,1,3,1" VerticalAlignment="Center" Source="pack://application:,,,/Resources/Images/Common/Add.ico" />
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </aCtrls:AncDataGrid.ContextMenu>
                        <aCtrls:AncDataGrid.Resources>
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="{StaticResource ResourceKey=OverColor2}"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="{StaticResource ResourceKey=OverColor2}"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>
                            <SolidColorBrush x:Key="disabledField" Color="#FFF0F0F0" />

                            <Style x:Key="lblDisplay" TargetType="{x:Type Label}" BasedOn="{StaticResource ResourceKey=ValidateElementRedBorder}">
                                <Setter Property="VerticalContentAlignment" Value="Center" />
                                <Setter Property="Padding" Value="2,0,2,0" />
                                <Setter Property="VerticalContentAlignment" Value="Center" />
                                <Setter Property="ToolTipService.ShowDuration" Value="60000" />

                                <Style.Triggers>
                                    <Trigger Property="Validation.HasError" Value="False">
                                        <Setter Property="ToolTip" Value="{Binding Path=Content, RelativeSource={RelativeSource Self}}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>

                            <Style x:Key="StandardCellStyle" TargetType="{x:Type DataGridCell}" >
                                <EventSetter Event="PreviewMouseDown" Handler="Cell_PreviewMouseDown" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type DataGridCell}">
                                            <Border x:Name="Border" Height="{TemplateBinding Height}" Padding="{TemplateBinding Padding}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                                                <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>

                            <Style x:Key="NoTabStopCellStyle" TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource StandardCellStyle}" >
                                <Setter Property="KeyboardNavigation.IsTabStop" Value="False" />
                                <Setter Property="KeyboardNavigation.TabNavigation" Value="None" />
                            </Style>

                            <Style x:Key="DisabledCellStyle" TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource StandardCellStyle}" >
                                <Setter Property="KeyboardNavigation.IsTabStop" Value="False" />
                                <Setter Property="KeyboardNavigation.TabNavigation" Value="None" />
                                <Setter Property="Background" Value="#7FE6E6E6" />
                                <Setter Property="BorderBrush" Value="#99E6E6E6" />
                            </Style>

                            <DataTemplate x:Key="SumFooterTemplate">
                                <Border ToolTip="Totalvægt (sum)" Background="Transparent">
                                    <TextBlock Text="{Binding}" Margin="3,1,3,1" HorizontalAlignment="Left" VerticalAlignment="Top" LineStackingStrategy="BlockLineHeight"  FontSize="11" LineHeight="12" Foreground="{StaticResource ResourceKey=UpperHeaderForegroundColor}" />
                                </Border>
                            </DataTemplate>
                            <DataTemplate x:Key="SumMultiFooterTemplate">
                                <Border Background="Transparent">
                                    <StackPanel Margin="3,1,3,1" Orientation="Vertical" VerticalAlignment="Top" >
                                        <TextBlock Text="{Binding Path=Item1, StringFormat='{}{0:0.####}'}" ToolTip="Totalvægt (sum)" LineStackingStrategy="BlockLineHeight" FontSize="11" LineHeight="12" HorizontalAlignment="Left" VerticalAlignment="Top" Foreground="{StaticResource ResourceKey=UpperHeaderForegroundColor}" />
                                        <Rectangle Height="1" SnapsToDevicePixels="True" Stroke="Gray" StrokeThickness="0,1,0,0" />
                                        <TextBlock Text="{Binding Path=Item2, StringFormat='{}{0:0.####}'}" ToolTip="Totalvægt (UR) (sum)" Margin="0,0,0,0" LineStackingStrategy="BlockLineHeight"  FontSize="11" LineHeight="12" HorizontalAlignment="Left" VerticalAlignment="Top" Foreground="{StaticResource ResourceKey=UpperHeaderForegroundColor}" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </aCtrls:AncDataGrid.Resources>
                        <aCtrls:AncDataGrid.RowStyle>
                            <Style TargetType="{x:Type DataGridRow}">
                                <Setter Property="FontSize" Value="12" />
                                <Setter Property="MinHeight" Value="24" />
                                <Setter Property="VerticalContentAlignment" Value="Center" />
                                <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                <Setter Property="Tag" Value="{Binding Path=DataContext, ElementName=uCtrl}" />
                                <!--  <EventSetter Event="MouseDoubleClick" Handler="RowDoubleClick"/> -->
                                <EventSetter Event="KeyDown" Handler="KeyDownHandler" />

                                <Setter Property="ContextMenu">
                                    <Setter.Value>
                                        <ContextMenu DataContext="{Binding Path=PlacementTarget.DataContext, RelativeSource={x:Static RelativeSource.Self}}" 
                                             Tag="{Binding Path=PlacementTarget.Tag, RelativeSource={x:Static RelativeSource.Self}}" >
                                            <MenuItem Header="Tilføj række" Command="{Binding Path=Tag.AddRowCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Style="{StaticResource defaultMenuItem}" >
                                                <MenuItem.Icon>
                                                    <Image Width="15" Height="15" Margin="3,1,3,1" VerticalAlignment="Center" Source="pack://application:,,,/Resources/Images/Common/Add.ico" />
                                                </MenuItem.Icon>
                                            </MenuItem>
                                            <Separator />
                                            <MenuItem Header="LAV, rep" Command="{Binding Path=Tag.ShowLAVRepCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                                                       IsEnabled="{Binding Path=Tag.SpeciesListStatistics.IsLavRepEnabled, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                      CommandParameter="{Binding Path=.}" Style="{StaticResource defaultMenuItem}" >
                                                <MenuItem.Icon>
                                                    <Image Width="18" Height="18" Margin="3,1,3,1" VerticalAlignment="Center" Source="pack://application:,,,/Resources/Images/Treeview/law.png" />
                                                </MenuItem.Icon>
                                            </MenuItem>
                                            <MenuItem Header="Enkeltfisk, rep" Command="{Binding Path=Tag.ShowSFRepCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                                                      IsEnabled="{Binding Path=Tag.SpeciesListStatistics.IsSFRepEnabled, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                      CommandParameter="{Binding Path=.}" Style="{StaticResource defaultMenuItem}" >
                                                <MenuItem.Icon>
                                                    <Image Width="18" Height="18" Margin="3,1,3,1" VerticalAlignment="Center" Source="pack://application:,,,/Resources/Images/Treeview/singlefish.png" />
                                                </MenuItem.Icon>
                                            </MenuItem>
                                            <MenuItem Header="Enkeltfisk, ej rep" Command="{Binding Path=Tag.ShowSFNotRepCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding Path=.}" Style="{StaticResource defaultMenuItem}" >
                                                <MenuItem.Icon>
                                                    <Image Width="18" Height="18" Margin="3,1,3,1" VerticalAlignment="Center" Source="pack://application:,,,/Resources/Images/Treeview/singlefishO.png" />
                                                </MenuItem.Icon>
                                            </MenuItem>
                                        </ContextMenu>
                                    </Setter.Value>
                                </Setter>

                                <Style.Triggers>
                                    <MultiDataTrigger >
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding Path=IsNew}" Value="True" />
                                            <Condition Binding="{Binding Path=HasUnsavedData}" Value="False" />
                                            <Condition Binding="{Binding Path=IsSelected}" Value="False" />
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Opacity" Value="0.3" />
                                    </MultiDataTrigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Opacity" Value="0.8" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </aCtrls:AncDataGrid.RowStyle>
                        <aCtrls:AncDataGrid.CellStyle>
                            <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource StandardCellStyle}" >
                                <EventSetter Event="PreviewKeyDown" Handler="PreviewKeyDown_Handler" />
                                <EventSetter Event="PreviewKeyUp" Handler="PreviewKeyUp_Handler" />
                            </Style>
                        </aCtrls:AncDataGrid.CellStyle>
                        <aCtrls:AncDataGrid.Columns>
                            <!-- Remove row column -->
                            <aCtrls:AncDataGridTemplateColumn HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderSettings}" CellStyle="{StaticResource NoTabStopCellStyle}" Width="25" MinWidth="25">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="" LowerHeaderHorizontalAlignment="Center" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Template="{StaticResource ResourceKey=imageButton}" BorderBrush="LightGray"
                                                IsEnabled="{Binding Path=CanEditOffline}"
                                        Command="{Binding Path=DataContext.RemoveCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding .}">
                                            <Image Source="pack://application:,,,/Resources/Images/Common/Remove.ico"  ToolTip="Slet række"
                                           Margin="3" VerticalAlignment="Center" HorizontalAlignment="Center"  Height="14" />
                                        </Button>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Index -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="Index" CellStyle="{StaticResource DisabledCellStyle}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="25" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|Index'}" >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="#" LowerHeaderHorizontalAlignment="Center" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=Index, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" HorizontalContentAlignment="Center" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Species -->
                            <aCtrls:AncDataGridTemplateColumn Width="55" SortMemberPath="Species" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|Species'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Art" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=Species, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, Mode=OneWay}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.Species, Source={StaticResource proxyContext}}" DisplayMemberPath="UIDisplay"
                                                         TabOnEnter="False" Initialized="FilteredComboBox_Initialized" DropDownWidth="300" OpenDropDownOnFilter="True" OpenOnFocus="True"
                                                            MinimumSearchLength="1" IsEditable="True" IsTextSearchCaseSensitive="False" FilterFromStart="True"
                                                            FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}"
                                                            SelectedValue="{Binding Path=Species}" SelectedValuePath="speciesCode" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Landing category -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="LandingCategory" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|LandingCategory'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="105">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Landingskategori" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=LandingCategory, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.LandingCategories, Source={StaticResource proxyContext}}" DisplayMemberPath="UIDisplay"
                                                         TabOnEnter="False" MinimumSearchLength="1"  IsTextSearchCaseSensitive="False"
                                                                 DropDownWidth="300" FilterFromStart="True" IsEditable="True" OpenDropDownOnFilter="True" OpenOnFocus="True"
                                                         FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="FilteredComboBox_Initialized"
                                                         SelectedValue="{Binding Path=LandingCategory, UpdateSourceTrigger=LostFocus}" SelectedValuePath="landingCategory" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Size sorting EU -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SizeSorting" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|SizeSorting'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="60">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Sortering" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SizeSorting, UpdateSourceTrigger=PropertyChanged, Mode=OneWay, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.SizeSortingsEU, Source={StaticResource proxyContext}, Mode=OneWay}" DisplayMemberPath="UIDisplay"
                                                           TabOnEnter="False"  MinimumSearchLength="1" IsTextSearchCaseSensitive="False" DropDownWidth="300" FilterFromStart="True"
                                                            FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="FilteredComboBox_Initialized"
                                                            SelectedValue="{Binding Path=SizeSorting}" SelectedValuePath="sizeSortingEU"  IsEditable="True" OpenDropDownOnFilter="True" OpenOnFocus="True" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Size sorting DFU -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SizeSortingDFU" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|SizeSortingDFU'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="60">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Opdeling" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SizeSortingDFU, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.SizeSortingsDFU, Source={StaticResource proxyContext}}" DisplayMemberPath="UIDisplay"
                                                           TabOnEnter="False"  MinimumSearchLength="1" IsEditable="True" IsTextSearchCaseSensitive="False" FilterFromStart="True"
                                                            FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="FilteredComboBox_Initialized"
                                                            SelectedValue="{Binding Path=SizeSortingDFU}" SelectedValuePath="sizeSortingDFU" OpenDropDownOnFilter="True" OpenOnFocus="True" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Treatment -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="Treatment" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|Treatment'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="72">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Behandling" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=Treatment, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.Treatments, Source={StaticResource proxyContext}}" DisplayMemberPath="UIDisplay"
                                                          TabOnEnter="False"   MinimumSearchLength="1" IsEditable="True" IsTextSearchCaseSensitive="False"
                                                                 DropDownWidth="300" FilterFromStart="True"
                                                            FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="FilteredComboBox_Initialized"
                                                            SelectedValue="{Binding Path=Treatment}" SelectedValuePath="treatment" OpenDropDownOnFilter="False" OpenOnFocus="False" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Sex -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="Sex" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|Sex'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="50" >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Køn" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=Sex, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.SexCodes, Source={StaticResource proxyContext}}" DisplayMemberPath="UIDisplay"
                                                          TabOnEnter="False"   MinimumSearchLength="1" IsEditable="True" IsTextSearchCaseSensitive="False" FilterFromStart="True"
                                                            FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="FilteredComboBox_Initialized"
                                                            SelectedValue="{Binding Path=Sex}" SelectedValuePath="sexCode" OpenDropDownOnFilter="True" OpenOnFocus="True" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Ovigorous -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="Ovigorous" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|Ovigorous'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="40" >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Rogn" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" LowerHeaderHorizontalAlignment="Center" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label HorizontalAlignment="Center">
                                            <Label.Style>
                                                <Style TargetType="{x:Type Label}" BasedOn="{StaticResource lblDisplay}">
                                                    <Setter Property="Content" Value="" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=Ovigorous, UpdateSourceTrigger=PropertyChanged}" Value="True">
                                                            <Setter Property="Content" Value="Ja" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Path=Ovigorous, UpdateSourceTrigger=PropertyChanged}" Value="{x:Null}">
                                                            <Setter Property="Content" Value="Nej" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Label.Style>
                                        </Label>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                            <CheckBox IsChecked="{Binding Path=Ovigorous}" IsThreeState="True" Margin="0,1,0,0"  Initialized="CheckBox_Initialized" VerticalAlignment="Center" HorizontalAlignment="Center" FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Style="{StaticResource sCheckBoxDataGridThreeState}" ></CheckBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Application -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="ApplicationCode" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|Application'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="72">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Anvendelse" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=ApplicationCode, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.Applications, Source={StaticResource proxyContext}}" DisplayMemberPath="UIDisplay"
                                                                 TabOnEnter="False"   MinimumSearchLength="1" IsEditable="True" IsTextSearchCaseSensitive="False"
                                                                 DropDownWidth="300" FilterFromStart="True"
                                                                 FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="FilteredComboBox_Initialized"
                                                                 SelectedValue="{Binding Path=ApplicationCode}" SelectedValuePath="code"
                                                                 OpenDropDownOnFilter="False" OpenOnFocus="False" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Number -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="Number" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|Number'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="50" >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Antal" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=Number, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=Number, Converter={StaticResource ResourceKey=cStringToInt}}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Weight 0 single -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SubSampleWeightStep0" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cStringShowOnContains}, ConverterParameter='VID, SØS'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="65"
                                                              CellFooterContent="{Binding Path=Data.Step0SumTuple, Source={StaticResource proxyContext}}" CellFooterContentTemplate="{StaticResource ResourceKey=SumMultiFooterTemplate}"
                                                          >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Vægt (kg)" UpperHeader="Trin 0" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" UpperHeaderForeground="{StaticResource UpperHeaderForegroundColor}" UpperHeaderBorderBrush="{StaticResource Step0Color}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SubSampleWeightStep0, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=SubSampleWeightStep0, UpdateSourceTrigger=LostFocus}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Weight 0 double -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SubSampleWeightStep0" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cStringShowOnContains}, ConverterParameter='HVN'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="65"
                                                          CellFooterContent="{Binding Path=Data.Step0SumTuple, Source={StaticResource proxyContext}}" CellFooterContentTemplate="{StaticResource ResourceKey=SumMultiFooterTemplate}"
                                                          >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Vægt (kg)" UpperHeader="Trin 0" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" UpperHeaderForeground="{StaticResource UpperHeaderForegroundColor}" UpperHeaderBorderBrush="{StaticResource Step0Color}" UpperHeaderBorderThickness="0,0,0,2" HeaderBorder="0,0,0,1" LowerHeaderBorder="0,0,1,0" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SubSampleWeightStep0, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=SubSampleWeightStep0, UpdateSourceTrigger=LostFocus}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Landing weight 0 -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SubSampleLandingWeightStep0" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cStringShowOnContains}, ConverterParameter='HVN'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="90"
                                                          CellFooterContent="{Binding Path=Data.Step0LandingSum, StringFormat='{}{0:0.####}', Source={StaticResource proxyContext}}" CellFooterContentTemplate="{StaticResource ResourceKey=SumFooterTemplate}"
                                                          >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Købsvægt (kg)" UpperHeaderBorderBrush="{StaticResource Step0Color}" UpperHeaderBorderThickness="0,0,0,2" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" UpperHeaderForeground="{StaticResource UpperHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SubSampleLandingWeightStep0, Converter={StaticResource ResourceKey=cStringToDecimal}, ConverterParameter=4, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=SubSampleLandingWeightStep0, Converter={StaticResource ResourceKey=cStringToDecimal}, ConverterParameter=4}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Weight 1 -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SubSampleWeightStep1" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|SubSampleWeightStep1'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="65"
                                                          CellFooterContent="{Binding Path=Data.Step1SumTuple, Source={StaticResource proxyContext}}" CellFooterContentTemplate="{StaticResource ResourceKey=SumMultiFooterTemplate}"
                                                          >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Vægt (kg)" UpperHeader="Trin 1" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" UpperHeaderForeground="{StaticResource UpperHeaderForegroundColor}" UpperHeaderBorderBrush="{StaticResource Step1Color}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SubSampleWeightStep1, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=SubSampleWeightStep1, UpdateSourceTrigger=LostFocus}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Weight 2 -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SubSampleWeightStep2" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|SubSampleWeightStep2'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="65"
                                                          CellFooterContent="{Binding Path=Data.Step2SumTuple, Source={StaticResource proxyContext}}" CellFooterContentTemplate="{StaticResource ResourceKey=SumMultiFooterTemplate}"
                                                          >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Vægt (kg)" UpperHeader="Trin 2" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" UpperHeaderForeground="{StaticResource UpperHeaderForegroundColor}" UpperHeaderBorderBrush="{StaticResource Step2Color}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SubSampleWeightStep2, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=SubSampleWeightStep2, UpdateSourceTrigger=LostFocus}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Weight Ej Rep -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SubSampleWeightNotRep" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|SubSampleWeightNotRep'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="65"
                                                          CellFooterContent="{Binding Path=Data.StepNotRepSumString, Source={StaticResource proxyContext}}" CellFooterContentTemplate="{StaticResource ResourceKey=SumFooterTemplate}"
                                                          >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Vægt (kg)" UpperHeader="Ej Rep" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" UpperHeaderForeground="{StaticResource UpperHeaderForegroundColor}" UpperHeaderBorderBrush="{StaticResource StepEjRepColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SubSampleWeightNotRep, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=SubSampleWeightNotRep, UpdateSourceTrigger=LostFocus}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Weight BMS Ej Rep -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="SubSampleWeightBMSNotRep" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|SubSampleWeightBMSNotRep'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="70"
                                                          CellFooterContent="{Binding Path=Data.StepBMSNotRepSumString, Source={StaticResource proxyContext}}" CellFooterContentTemplate="{StaticResource ResourceKey=SumFooterTemplate}"
                                                          >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Vægt (kg)" UpperHeader="BMS Ej Rep" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" UpperHeaderForeground="{StaticResource UpperHeaderForegroundColor}" UpperHeaderBorderBrush="{StaticResource StepEjRepColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=SubSampleWeightBMSNotRep, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding Path=SubSampleWeightBMSNotRep, UpdateSourceTrigger=LostFocus}" VerticalContentAlignment="Center"  FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="TextBox_Initialized"  BorderThickness="0" Padding="0,0,0,0"  ></TextBox>
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- LE -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="LE" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|LE'}" CellStyle="{StaticResource DisabledCellStyle}"  HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="22" IsReadOnly="True" >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="LE" LowerHeaderHorizontalAlignment="Center" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=LE, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" HorizontalAlignment="Center" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Weight estimation method -->
                            <aCtrls:AncDataGridTemplateColumn SortMemberPath="WeightEstimationMethod" Visibility="{Binding Path=Data.TripType, Source={StaticResource proxyContext}, Converter={StaticResource ResourceKey=cColumnMapToVisibility}, ConverterParameter='SpeciesList|WeightEstimationMethod'}" HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="145">
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Vægtestimeringsmetode" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Label Content="{Binding Path=WeightEstimationMethod, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Style="{StaticResource lblDisplay}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <aCtrls:FilteredComboBox ItemsSource="{Binding Path=Data.WeightEstimationMethods, Source={StaticResource proxyContext}}" DisplayMemberPath="UIDisplay"
                                                         TabOnEnter="False"   MinimumSearchLength="1" IsEditable="True" IsTextSearchCaseSensitive="False"
                                                                 DropDownWidth="300"
                                                         FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}" Initialized="FilteredComboBox_Initialized"
                                                         SelectedValue="{Binding Path=WeightEstimationMethod}" SelectedValuePath="weightEstimationMethod" OpenDropDownOnFilter="True" OpenOnFocus="True" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                            </aCtrls:AncDataGridTemplateColumn>

                            <!-- Remark -->
                            <aCtrls:AncDataGridTemplateColumn HeaderTemplate="{StaticResource ResourceKey=GridColumnHeaderDefault}" Width="*" >
                                <aCtrls:AncDataGridTemplateColumn.Header>
                                    <dGrid:DoubleColumnHeader LowerHeader="Bemærkning" LowerHeaderForeground="{StaticResource ResourceKey=LowerHeaderForegroundColor}" />
                                </aCtrls:AncDataGridTemplateColumn.Header>
                                <aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Path=Remark, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, Mode=OneWay}" ToolTip="{Binding Path=Remark, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}" ToolTipService.ShowDuration="60000" VerticalAlignment="Center" Padding="2,0,2,0" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" Style="{StaticResource ResourceKey=ValidateElementRedBorder}" />
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellTemplate>
                                <aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        
                                        <aCtrls:DropDownTextBox IsTabStop="False" OpenOnAnyKey="True" VerticalAlignment="Center" TextWrapping="Wrap" 
                                                        OpenOnLoad="True" FocusOnLoad="True" Initialized="DropDownTextBox_Initialized"
                                                        Text="{Binding Path=Remark, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" >
                                            <TextBlock Text="{Binding Path=Remark, Mode=OneWay}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" ToolTip="{Binding Path=Remark, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </aCtrls:DropDownTextBox>
                                      
                                    </DataTemplate>
                                </aCtrls:AncDataGridTemplateColumn.CellEditingTemplate>

                            </aCtrls:AncDataGridTemplateColumn>
                        </aCtrls:AncDataGrid.Columns>
                    </aCtrls:AncDataGrid>
                </Border>

            </DockPanel>

            <!-- Zoom slider -->
            <ancSl:ZoomSlider Grid.Row="1" Margin="0,0,0,2" Value="{Binding Source={x:Static set:Settings.Instance}, Path=ZoomLevelSpeciesList}" Width="120" HorizontalAlignment="Right" VerticalAlignment="Bottom" >
                <ancSl:ZoomSlider.Style>
                    <Style TargetType="{x:Type ancSl:ZoomSlider}" BasedOn="{StaticResource lightZoomSlider}">
                        <Setter Property="Opacity" Value="0.2" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0.2" To="1.0" Duration="0:0:0.5"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="1.0" To="0.2" Duration="0:0:0.5"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ancSl:ZoomSlider.Style>
            </ancSl:ZoomSlider>

            <!-- Row details pane  -->
            <Grid Grid.Row="3" x:Name="grdFilter" Height="100" IsEnabled="{Binding Path=IsLoading, Converter={StaticResource ResourceKey=cBoolToBoolNegation}}">
                <Border  BorderBrush="#FFAAAAAA" BorderThickness="0,1,0,0" SnapsToDevicePixels="True" Background="{StaticResource ResourceKey=GeneralBackground}" KeyboardNavigation.TabNavigation="None" KeyboardNavigation.IsTabStop="False">
                    <Border.Style>
                        <Style TargetType="{x:Type Border}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectedItem}" Value="{x:Null}" >
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    
                    <DockPanel Margin="8">

                        <UniformGrid HorizontalAlignment="Left" Rows="3" Columns="1" IsEnabled="{Binding Path=HasSelectedItem}">
                            <Button Command="{Binding Path=ShowLAVRepCommand}" CommandParameter="{Binding Path=SelectedItem}"  SnapsToDevicePixels="True" DockPanel.Dock="Top"
                                    IsEnabled="{Binding Path=SpeciesListStatistics.IsLavRepEnabled}"
                                HorizontalAlignment="Left" Margin="0,0,0,2" KeyboardNavigation.TabIndex="3"
                                Template="{StaticResource ResourceKey=standardButtonBrighter}" Width="140"  > 
                                <Button.Content>
                                    <DockPanel Width="170">
                                        <Image Opacity="0.7" DockPanel.Dock="Left" Source="pack://application:,,,/Resources/Images/Treeview/law.png" Margin="4,1,7,0" Width="16" >
                                        </Image>
                                        <TextBlock FontWeight="Normal" DockPanel.Dock="Left" Text="LAV, rep" VerticalAlignment="Center" FontSize="13" Margin="0,0,8,0" >
                                        </TextBlock>

                                        <TextBlock HorizontalAlignment="Right" VerticalAlignment="Center" Visibility="Collapsed" Text="{Binding Path=SpeciesListStatistics.RepLavCount, StringFormat='({0})'}" ToolTip="Antal eksisterende 'LAV, rep' rækker." />
                                    </DockPanel>
                                </Button.Content>
                            </Button>

                            <Button Command="{Binding Path=ShowSFRepCommand}" CommandParameter="{Binding Path=SelectedItem}"
                                    IsEnabled="{Binding Path=SpeciesListStatistics.IsSFRepEnabled}"
                                    SnapsToDevicePixels="True" DockPanel.Dock="Top"
                                HorizontalAlignment="Left" Margin="0,1,0,1" KeyboardNavigation.TabIndex="3"
                                Template="{StaticResource ResourceKey=standardButtonBrighter}" Width="140" >
                                <Button.Content>
                                    <DockPanel Width="170">
                                        <Image Opacity="0.7" DockPanel.Dock="Left" Source="pack://application:,,,/Resources/Images/Treeview/singlefish.png" Margin="4,0,7,0"  Width="16" >
                                        </Image>
                                        <TextBlock FontWeight="Normal" DockPanel.Dock="Left" Text="Enkeltfisk, rep" FontSize="13" VerticalAlignment="Center" Margin="0,0,8,0" >
                                        </TextBlock>
                                        <TextBlock HorizontalAlignment="Right" VerticalAlignment="Center" Visibility="Collapsed" Text="{Binding Path=SpeciesListStatistics.RepSFCount, StringFormat='({0})'}" ToolTip="Antal eksisterende 'Enkeltfisk, rep' rækker." />
                                    </DockPanel>
                                </Button.Content>
                            </Button>

                            <Button Command="{Binding Path=ShowSFNotRepCommand}" CommandParameter="{Binding Path=SelectedItem}"   SnapsToDevicePixels="True" DockPanel.Dock="Top"
                                    IsEnabled="{Binding Path=SpeciesListStatistics.IsSFNotRepEnabled}"
                                HorizontalAlignment="Left" Margin="0,2,0,0" KeyboardNavigation.TabIndex="3"
                                Template="{StaticResource ResourceKey=standardButtonBrighter}" Width="140" >
                                <Button.Content>
                                    <DockPanel Width="170">
                                        <Image Opacity="0.7" DockPanel.Dock="Left" Source="pack://application:,,,/Resources/Images/Treeview/singlefishO.png" Margin="4,0,7,0"  Width="16" ></Image>
                                        <TextBlock FontWeight="Normal" DockPanel.Dock="Left" VerticalAlignment="Center" Text="Enkeltfisk, ej rep" FontSize="13" Margin="0,0,8,0" ></TextBlock>
                                        <TextBlock HorizontalAlignment="Right" VerticalAlignment="Center" Visibility="Collapsed" Text="{Binding Path=SpeciesListStatistics.NotRepSFCount, StringFormat='({0})'}" ToolTip="Antal eksisterende 'Enkeltfisk, ej rep' rækker." />
                                    </DockPanel>
                                </Button.Content>
                            </Button>

                            <StackPanel />
                        </UniformGrid>

                        <Border BorderBrush="#FFAAAAAA" BorderThickness="1" Margin="3,0,0,0" DockPanel.Dock="Left" SnapsToDevicePixels="True" >
                            <Border.Style>
                                <Style TargetType="{x:Type Border}">
                                    <Style.Triggers>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Opacity" Value="0.5" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid Margin="0" SnapsToDevicePixels="True"  >
                             <!--   <Grid  >
                                    <Border BorderBrush="#FFE2E2E2" BorderThickness="1,1,0,0" SnapsToDevicePixels="True" />
                                    <Border BorderBrush="#49636363" BorderThickness="0,0,1,1" SnapsToDevicePixels="True" />
                                </Grid>-->

                                <inp:SpeciesListStatisticsView DataContext="{Binding Path=SpeciesListStatistics}"  Margin="1" TextBlock.FontSize="11" />
                            </Grid>
                        </Border>
                        
                        <StackPanel />
                    </DockPanel>
                </Border>

            </Grid>

            <!-- Show/Hide row details button -->
            <ToggleButton x:Name="tglBtnFilter" Grid.Row="2" Panel.ZIndex="100" VerticalAlignment="Bottom" HorizontalAlignment="Center"
                          KeyboardNavigation.TabNavigation="None" KeyboardNavigation.IsTabStop="False"
                              ToolTip="Vis/Skjul række-detaljer" IsChecked="{Binding Source={x:Static set:Settings.Instance}, Path=IsSpeciesListRowDetailsCollapsed, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                              Margin="0,0,0,-8" Height="8" Width="150" Opacity="0.7" >
                <TextBlock Text="v  v  v  v  v" FontSize="8" Foreground="#FF1D1D1D" HorizontalAlignment="Center" >
                    <TextBlock.Style>
                        <Style TargetType="{x:Type TextBlock}">
                            <Setter Property="LayoutTransform" >
                                <Setter.Value>
                                    <ScaleTransform ScaleY="1" />
                                </Setter.Value>
                            </Setter>
                            <Setter Property="Margin" Value="0,-4,0,0" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=IsChecked, ElementName=tglBtnFilter}" Value="True">
                                    <Setter Property="LayoutTransform" >
                                        <Setter.Value>
                                            <ScaleTransform ScaleY="-1" />
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="Margin" Value="0,-1,0,0" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <ToggleButton.Template>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border x:Name="bdr" Padding="0" BorderBrush="Gray" BorderThickness="1" CornerRadius="0,0,2,2">
                            <Border.Background>
                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                    <GradientStop Color="#FFFDFDFD" Offset="0"/>
                                    <GradientStop Color="#FFECECEC" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="ToggleButton.IsEnabled" Value="False">
                                <Setter TargetName="bdr" Property="Opacity" Value="0.4" />
                            </Trigger>
                            <Trigger Property="ToggleButton.IsMouseOver" Value="True">
                                <Setter TargetName="bdr" Property="Background" >
                                    <Setter.Value>
                                        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                            <GradientStop Color="#FFCBD6EC" Offset="1.0"/>
                                            <GradientStop Color="White" Offset="0.0"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="ToggleButton.IsPressed" Value="True">
                                <Setter TargetName="bdr" Property="Background" >
                                    <Setter.Value>
                                        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                            <GradientStop Color="#FFEAEAEC" Offset="1.0"/>
                                            <GradientStop Color="White" Offset="0.0"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </ToggleButton.Template>
            </ToggleButton>

            <!-- Bottom Buttons -->
            <Grid Grid.Row="4" KeyboardNavigation.TabNavigation="Local" KeyboardNavigation.TabIndex="3" Panel.ZIndex="10">
                <Border Height="50" BorderBrush="{StaticResource ResourceKey=GridBorderBrush}" BorderThickness="0,1,0,0" Background="{StaticResource InputHeaderBackground}" SnapsToDevicePixels="True" >
                    <DockPanel DockPanel.Dock="Bottom" Margin="10,5,10,5" IsEnabled="{Binding Path=IsLoading, Converter={StaticResource ResourceKey=cBoolToBoolNegation}}" >

                        <DockPanel DockPanel.Dock="Left" VerticalAlignment="Center" >

                            <!-- Save button -->
                            <Button Command="{Binding Path=SaveCommand}" SnapsToDevicePixels="True" Content="Gem" DockPanel.Dock="Left"
                             KeyboardNavigation.TabIndex="1" 
                            HorizontalAlignment="Right" Margin="0,0,10,0" ToolTip="Gem ændringer (ctrl+s)" ToolTipService.ShowDuration="30000"
                            Template="{StaticResource ResourceKey=standardButton}"
                            Width="120" FontSize="15" >
                                <Button.Style>
                                    <Style TargetType="{x:Type Button}">
                                        <Setter Property="IsEnabled" Value="{Binding Path=HasEditingRights}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Path=CanEditOffline}" Value="False">
                                                <Setter Property="IsEnabled" Value="False" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>

                            
                            <!-- Close button -->
                            <Button Command="{Binding Path=CloseCommand}" SnapsToDevicePixels="True" Content="Luk" DockPanel.Dock="Right"
                             KeyboardNavigation.TabIndex="4"
                            HorizontalAlignment="Right" Margin="0,0,0,0"
                            Template="{StaticResource ResourceKey=standardButton}"
                            Width="100" FontSize="15" >
                            </Button>

                            <!-- DeleteAll SpeciesListItems -->
                            <Button Command="{Binding Path=DeleteAllSpeciesListItemsCommand}"  SnapsToDevicePixels="True" DockPanel.Dock="Right"
                                    IsEnabled="{Binding Path=CanEditOffline}"
                                HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,10,0" KeyboardNavigation.TabIndex="3"
                                Template="{StaticResource ResourceKey=standardButtonBright}"  FontSize="15" >
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <Image Opacity="0.95" Margin="4,1,6,0" Width="13" VerticalAlignment="Center" Source="pack://application:,,,/Resources/Images/Common/Remove.ico" ></Image>
                                        <TextBlock FontWeight="Normal" FontSize="14" Margin="0,0,8,0" Text="Slet alle rækker" ></TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                            
                            <!-- To Cruise button -->
                            <Button Command="{Binding Path=ShowParentCommand}"  SnapsToDevicePixels="True" DockPanel.Dock="Right"
                                HorizontalAlignment="Right" Margin="0,0,10,0" KeyboardNavigation.TabIndex="2"
                                Template="{StaticResource ResourceKey=standardButtonBright}"  FontSize="15" >
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <Image Opacity="0.7" VerticalAlignment="Center" >
                                            <Image.Style>
                                                <Style TargetType="{x:Type Image}">
                                                    <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/sample.png" />
                                                    <Setter Property="Margin" Value="4,1,7,0" />
                                                    <Setter Property="Width"  Value="18" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=TripType}" Value="HVN">
                                                            <Setter Property="Source" Value="pack://application:,,,/Resources/Images/Treeview/hvn.ico" />
                                                            <Setter Property="Margin" Value="4,0,7,0" />
                                                            <Setter Property="Width"  Value="17" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>
                                        <TextBlock FontWeight="Normal" FontSize="14" Margin="0,0,8,0" >
                                            <TextBlock.Style>
                                                <Style TargetType="{x:Type TextBlock}">
                                                    <Setter Property="Text" Value="Til station" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=TripType}" Value="HVN">
                                                            <Setter Property="Text" Value="Til tur" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>

                        </DockPanel>

                        <Border Margin="0,1,8,1">
                            <TextBlock  VerticalAlignment="Center" HorizontalAlignment="Center" TextWrapping="Wrap"
                                   FontSize="14" TextAlignment="Center" Foreground="#FFD80F0F" ToolTip="{Binding Path=Error}" Text="{Binding Path=Error}" />
                        </Border>

                        <!-- Message shown between buttons -->
                        <Border Margin="0,1,14,1" >
                            <Border.Style>
                                <Style TargetType="{x:Type Border}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=HasEditingRights}" Value="False">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Path=CanEditOffline}" Value="False">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock  VerticalAlignment="Center" HorizontalAlignment="Center" TextWrapping="Wrap" LineHeight="15" LineStackingStrategy="BlockLineHeight"
                                   FontSize="14" TextAlignment="Center" Foreground="{StaticResource ErrorForeground}" >
                            <TextBlock.Style>
                                <Style TargetType="{x:Type TextBlock}">
                                    <Setter Property="Text" Value="Du har ikke rettigheder til at gemme eventuelle ændringer" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=CanEditOffline}" Value="False">
                                            <Setter Property="Text" Value="Ændringer til hentet offline data kan ikke gemmes" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                            </TextBlock>
                        </Border>
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>
        
        <!-- Loading message -->
        <Grid Visibility="{Binding Path=IsLoading, Converter={StaticResource ResourceKey=cBoolToVisibility}, ConverterParameter=True, FallbackValue=Hidden}">
            <Border Background="#CCFFFFFF" HorizontalAlignment="Center" SnapsToDevicePixels="True" VerticalAlignment="Center" Margin="0,0,0,0" BorderBrush="Gray" BorderThickness="1" CornerRadius="0" >
                <DockPanel Margin="15,10,15,10" HorizontalAlignment="Center">
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding Path=LoadingMessage}"  FontSize="17"  />
                    </StackPanel>

                    <ProgressBar IsIndeterminate="True" Height="10" Margin="0,3,0,0" />
                </DockPanel>
            </Border>
        </Grid>
    </Grid>
    
</UserControl>
